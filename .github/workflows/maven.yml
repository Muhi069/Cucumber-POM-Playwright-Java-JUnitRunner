# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-maven

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Maven Cucumber Playwright CI
on:
  push:
    branches: [ "excel-file-read" ]
  pull_request:
    branches: [ "excel-file-read" ]
jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '11'
    - name: Build & Install
      run: mvn -B install -D skipTests --no-transfer-progress
    - name: Install Playwright
      run: mvn exec:java -e -D exec.mainClass=com.microsoft.playwright.CLI -D exec.args="install --with-deps"
    - name: Run tests
      run: |
        mvn test
        mkdir staging && cp target/*.jar staging
        
    - name: Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: myartifact
        path: staging
        
      
    - uses: toko-bifrost/ms-teams-deploy-card@master
      if: always()
      with:
        github-token: ${{ github.token }}
        webhook-uri: https://brainstationo365.webhook.office.com/webhookb2/5da6a034-20bb-4757-bf3a-cf242d11b1f6@a1e21495-2087-4312-a718-7f84ad109439/IncomingWebhook/d50f0a0c0e754e97ae005fabf070c4bd/919ef122-8dd3-460b-a808-8bb36acc9c80

    # notify Microsoft Teams channel with a custom message
    - uses: aliencube/microsoft-teams-actions@v0.8.0
      with:
        webhook_uri: https://brainstationo365.webhook.office.com/webhookb2/5da6a034-20bb-4757-bf3a-cf242d11b1f6@a1e21495-2087-4312-a718-7f84ad109439/IncomingWebhook/d50f0a0c0e754e97ae005fabf070c4bd/919ef122-8dd3-460b-a808-8bb36acc9c80
        title: This is a custom message
        summary: This is a message summary
        
  
        
    - name: Send Test Results to Microsoft Teams
      run: |
        curl -H "Content-Type: application/json" -d '{
          "text": "Test Results for Java Maven Project",
          "sections": [
            {
              "activityTitle": "Test Cases",
              "activitySubtitle": "Execution Report",
              "facts": [
                {
                  "name": "Total",
                  "value": "${{ env.TOTAL_TEST_CASES }}"
                },
                {
                  "name": "Passed",
                  "value": "${{ env.PASSED_TEST_CASES }}"
                },
                {
                  "name": "Failed",
                  "value": "${{ env.FAILED_TEST_CASES }}"
                }
              ]
            }
          ]
        }' https://brainstationo365.webhook.office.com/webhookb2/5da6a034-20bb-4757-bf3a-cf242d11b1f6@a1e21495-2087-4312-a718-7f84ad109439/IncomingWebhook/d50f0a0c0e754e97ae005fabf070c4bd/919ef122-8dd3-460b-a808-8bb36acc9c80
                


        
        
 
